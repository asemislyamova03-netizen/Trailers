{% extends "base.html" %}

{% block title %}Договоры{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Договоры / продажи</h1>
    <a href="{{ url_for('main.contract_create') }}" class="btn btn-primary">
        Новый договор
    </a>
</div>

<table class="table table-striped table-sm align-middle">
    <thead>
        <tr>
            <th>ID</th>
            <th>Дата</th>
            <th>Номер</th>
            <th>Клиент</th>
            <th>Тип</th>
            <th>VIN</th>
            <th>Артикул</th>
            <th>Сумма</th>
            <th>Способ оплаты</th>
            <th>Источник</th>
            <th>Оплачен</th>
            <th>Отгружен</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for c in contracts %}
        <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.contract_date or '' }}</td>
            <td>{{ c.contract_number or '' }}</td>
            <td>{{ c.customer.name if c.customer else '' }}</td>
            <td>
                {% if c.customer %}
                {% if c.customer.customer_type == 'PERSON' %}
                ФЛ
                {% elif c.customer.customer_type == 'COMPANY' %}
                ЮЛ
                {% else %}
                {{ c.customer.customer_type }}
                {% endif %}
                {% else %}
                -
                {% endif %}
            </td>
            <td>{{ c.trailer.vin if c.trailer else '' }}</td>
            <td>{{ c.trailer.item.article if c.trailer and c.trailer.item else '' }}</td>
            <td>{{ c.price or '' }}</td>
            <td>{{ c.payment_method or '' }}</td>
            <td>{{ c.source or '' }}</td>
            <td>
                {% if c.is_paid %}
                <span class="badge bg-success">Да</span>
                {% else %}
                <span class="badge bg-secondary">Нет</span>
                {% endif %}
            </td>
            <td>
                {% if c.is_shipped %}
                <span class="badge bg-success">Да</span>
                {% else %}
                <span class="badge bg-secondary">Нет</span>
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('main.contract_edit', contract_id=c.id) }}"
                    class="btn btn-sm btn-outline-primary me-1">
                    Изменить
                </a>
                <form action="{{ url_for('main.contract_delete', contract_id=c.id) }}" method="post"
                    style="display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Удалить договор?');">
                        Удалить
                    </button>
                </form>


                <a href="{{ url_for('main.contract_pdf', contract_id=c.id) }}" class="btn btn-sm btn-outline-secondary">
                    PDF
                </a>

                <a href="{{ url_for('main.contract_sign', contract_id=c.id) }}" class="btn btn-sm btn-outline-primary">
                    Подписать в SigeX
                </a>

            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}